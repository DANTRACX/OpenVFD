#include "REGISTRY.h"
#include <string.h>
#include "../../RES/MEM/MEM.h"

SETPOINTS_s SETPOINTS;
MEASUREMENTS_s MEASUREMENTS;
PARAMETERS_s PARAMETERS;

void REGISTRY_INIT(void)
{
    SETPOINTS.TIMED_ENABLE = 0;
    SETPOINTS.TARGET_FREQUENCY = 0;
    SETPOINTS.RELATIVE_TORQUE = 0;
    SETPOINTS.REVERSAL = 0;
    SETPOINTS.ENABLE_FREQUENCY_OVERDRIVE = 0;
    SETPOINTS.ENABLE_CURRENT_OVERDRIVE = 0;
    SETPOINTS.ENABLE_PROGMODE = 0;

    MEASUREMENTS.LINE_VOLTAGE = 0;
    MEASUREMENTS.LINE_CURRENT = 0;
    MEASUREMENTS.BUS_VOLTAGE = 0;
    MEASUREMENTS.BUS_CURRENT = 0;
    MEASUREMENTS.OUTPUT_FREQUENCY = 0;
    MEASUREMENTS.OUTPUT_POWER = 0;
    MEASUREMENTS.TEMPERATURE1 = 0;
    MEASUREMENTS.TEMPERATURE2 = 0;

    PARAMETERS.NOMINAL_FREQUENCY = 0;
    PARAMETERS.OVERDRIVE_FREQUENCY = 0;
    PARAMETERS.NOMINAL_FORWARD_LINE_CURRENT = 0;
    PARAMETERS.NOMINAL_REVERSE_LINE_CURRENT = 0;
    PARAMETERS.OVERDRIVE_FORWARD_LINE_CURRENT = 0;
    PARAMETERS.OVERDRIVE_REVERSE_LINE_CURRENT = 0;
    PARAMETERS.PWM_FREQUENCY = 0;
    PARAMETERS.ENABLE_TIMEOUT = 0;
    PARAMETERS.OVERDRIVE_TIMEOUT = 0;
    PARAMETERS.OVERDRIVE_COOLDOWN = 0;
    PARAMETERS.CONTROLLER_SAMPLETIME = 0;
    PARAMETERS.CONTROLLER_P_VALUE = 0;
    PARAMETERS.CONTROLLER_I_VALUE = 0;

    strcpy(PARAMETERS.SYSTEM_STATUS, "INITIALIZING");
    REGISTRY_READ();
}

void REGISTRY_READ(void)
{
    uint64_t temp = 0;

    if(MEM_READ64(1, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P001");
        return;
    }

    PARAMETERS.NOMINAL_FREQUENCY = (uint16_t)temp;

    if(MEM_READ64(2, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P002");
        return;
    }

    PARAMETERS.OVERDRIVE_FREQUENCY = (uint16_t)temp;

    if(MEM_READ64(3, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P003");
        return;
    }

    PARAMETERS.NOMINAL_FORWARD_LINE_CURRENT = (uint16_t)temp;

    if(MEM_READ64(4, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P004");
        return;
    }

    PARAMETERS.NOMINAL_REVERSE_LINE_CURRENT = (uint16_t)temp;

    if(MEM_READ64(5, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P005");
        return;
    }

    PARAMETERS.OVERDRIVE_FORWARD_LINE_CURRENT = (uint16_t)temp;

    if(MEM_READ64(6, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P006");
        return;
    }

    PARAMETERS.OVERDRIVE_REVERSE_LINE_CURRENT = (uint16_t)temp;

    if(MEM_READ64(7, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P007");
        return;
    }

    PARAMETERS.PWM_FREQUENCY = (uint8_t)temp;

    if(MEM_READ64(8, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P008");
        return;
    }

    PARAMETERS.ENABLE_TIMEOUT = (uint64_t)temp;

    if(MEM_READ64(9, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P009");
        return;
    }

    PARAMETERS.OVERDRIVE_TIMEOUT = (uint64_t)temp;

    if(MEM_READ64(10, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P010");
        return;
    }

    PARAMETERS.OVERDRIVE_COOLDOWN = (uint64_t)temp;

    if(MEM_READ64(11, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P011");
        return;
    }

    PARAMETERS.CONTROLLER_SAMPLETIME = (uint64_t)temp;

    if(MEM_READ64(12, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P0012");
        return;
    }

    PARAMETERS.CONTROLLER_P_VALUE = (int16_t)temp;

    if(MEM_READ64(13, &temp) < 0)
    {
        strcpy(PARAMETERS.SYSTEM_STATUS, "ERROR P013");
        return;
    }

    PARAMETERS.CONTROLLER_I_VALUE = (int16_t)temp;

    /* calculate data from registry */
    strcpy(PARAMETERS.SYSTEM_STATUS, "SYSTEM OK");
}

void REGISTRY_UPDATE(void)
{

}
